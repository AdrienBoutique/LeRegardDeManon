<app-section-title title="Soins" subtitle="Nos prestations"></app-section-title>

<section class="services-top card">
  <label class="search-field" for="services-search">
    Rechercher un soin
    <input
      id="services-search"
      type="search"
      placeholder="Nom ou mot-cle"
      [value]="searchTerm()"
      (input)="setSearch($any($event.target).value)"
      (focus)="onSearchFocus()"
      (blur)="onSearchBlur()"
    />

    @if (showSuggestions()) {
      <ul class="suggestions" role="listbox" aria-label="Suggestions de soins">
        @for (suggestion of searchSuggestions(); track suggestion.id) {
          <li>
            <button type="button" class="suggestion-item" (mousedown)="applySuggestion(suggestion)">
              <strong>{{ suggestion.name }}</strong>
              <span>{{ suggestion.category }}</span>
            </button>
          </li>
        }
      </ul>
    }
  </label>
</section>

<section class="categories-stack">
  @for (group of groupedCategories(); track group.id) {
    <section class="category-block">
      <button
        type="button"
        class="cat-header"
        (click)="toggleCategory(group.id)"
        [attr.aria-expanded]="isOpen(group.id)"
      >
        <div class="left">
          <h3>{{ group.name }}</h3>
          <span class="meta">{{ group.name }} · {{ group.items.length }}</span>
        </div>
        <span class="chev" [class.open]="isOpen(group.id)">⌄</span>
      </button>

      @if (isOpen(group.id)) {
        <div class="cat-body">
          <div class="grid soins-grid">
            @for (service of group.items; track service.id) {
              <article class="card service-card">
                <div class="stack">
                  <p class="chip">{{ service.category }}</p>
                  <h2>{{ service.name }}</h2>
                  <p class="summary">{{ service.description }}</p>
                </div>

                <div class="bottom">
                  <p class="meta">{{ service.durationMin }} min</p>
                  <p class="price">{{ formatPrice(service.priceCents) }}</p>
                </div>

                <a [routerLink]="['/soins', service.id]" class="btn btn-ghost">Voir le detail</a>
              </article>
            }
          </div>
        </div>
      }
    </section>
  }

  @if (groupedCategories().length === 0) {
    <article class="card empty-state">
      <h3>Aucun soin trouve</h3>
      <p>Essayez un autre mot-cle.</p>
    </article>
  }
</section>
