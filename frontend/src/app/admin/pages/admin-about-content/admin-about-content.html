<section class="admin-page stack">
  <header class="card heading">
    <div class="heading-top">
      <h1>Edition A propos</h1>
      <a routerLink="/admin/edition" class="btn btn-ghost">Retour au choix d'edition</a>
    </div>
    <p>Vous pouvez modifier et cacher/afficher chaque bloc.</p>
  </header>

  @if (errorMessage()) {
    <article class="card error-box">{{ errorMessage() }}</article>
  }

  @if (toastMessage()) {
    <article class="toast">{{ toastMessage() }}</article>
  }

  @if (loading()) {
    <article class="card panel"><p>Chargement...</p></article>
  } @else {
    <article class="card panel" [class.hidden-block]="!content().hero.visible">
      <div class="block-header">
        <h2>Hero</h2>
        <label><input type="checkbox" [checked]="content().hero.visible" (change)="patchHero('visible',$any($event.target).checked)" /> Visible</label>
      </div>
      <label>Titre <input [value]="content().hero.title" (input)="patchHero('title',$any($event.target).value)" /></label>
      <label>Introduction <textarea rows="3" [value]="content().hero.intro" (input)="patchHero('intro',$any($event.target).value)"></textarea></label>
    </article>

    @for (block of content().blocks; track block.id; let index = $index) {
      <article class="card panel" [class.hidden-block]="!block.visible">
        <div class="block-header">
          <h2>Bloc {{ index + 1 }}</h2>
          <div class="block-actions">
            <label><input type="checkbox" [checked]="block.visible" (change)="patchBlock(index,'visible',$any($event.target).checked)" /> Visible</label>
            <button type="button" class="btn btn-ghost btn-remove" (click)="removeBlock(index)">Supprimer</button>
          </div>
        </div>
        <label>Titre <input [value]="block.title" (input)="patchBlock(index,'title',$any($event.target).value)" /></label>
        <label>Texte <textarea rows="3" [value]="block.text" (input)="patchBlock(index,'text',$any($event.target).value)"></textarea></label>
      </article>
    }

    <div class="block-add">
      <button type="button" class="btn btn-ghost" (click)="addBlock()">+ Ajouter un bloc</button>
    </div>

    <div class="save-bar">
      <button type="button" class="btn btn-primary" [disabled]="saving()" (click)="save()">
        {{ saving() ? 'Enregistrement...' : 'Sauvegarder' }}
      </button>
    </div>
  }
</section>
